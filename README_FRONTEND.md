# Frontend — Lead Dashboard (React + Tailwind + Recharts)

Это одностраничное React-приложение (SPA) для визуализации лидов по автомобилям Kia. Данные приходят с backend-а на Google Apps Script.

## 1. Предварительные условия

- Установлен Node.js (LTS) и npm.
- У вас уже есть задеплоенный Apps Script backend, который отдает JSON по URL вида:

  ```text
  https://script.google.com/macros/s/XXXXXXXXXXXXXXX/exec
  ```

  (см. `apps-script/README_APPS_SCRIPT.md`).

## 2. Настройка переменных окружения (.env)

В корне `frontend` создайте файл `.env` со строкой:

```bash
REACT_APP_API_URL=https://script.google.com/macros/s/XXXXXXXXXXXXXXX/exec
```

Где вместо `XXXXXXXXXXXXXXX` подставьте реальный ID деплоя вашего Apps Script Web App.

> **Важно:** переменные окружения в Create React App должны начинаться с `REACT_APP_`. В коде фронта используется `process.env.REACT_APP_API_URL`.

## 3. Установка зависимостей

Из корня проекта выполните:

```bash
cd frontend
npm install
```

Будут установлены:

- `react`, `react-dom`, `react-scripts` — основа SPA.
- `axios` — HTTP-клиент для запросов к Apps Script.
- `recharts` — библиотека графиков (pie, bar, time series).
- `tailwindcss`, `postcss`, `autoprefixer` — стилизация.
- `date-fns` — форматирование дат.

## 4. Запуск dev-сервера

```bash
cd frontend
npm start
```

После сборки откройте в браузере:

```text
http://localhost:3000
```

При корректно настроенном `REACT_APP_API_URL` вы увидите:

- KPI-карточки (всего лидов, конверсия, высокий потенциал, последний лид, качественные лиды).
- Диаграммы:
  - Pie — распределение по качеству.
  - Горизонтальный bar — лиды по моделям (top 10).
  - Stacked bar — лиды за последние 30 дней по качеству.
- Таблицу лидов с фильтрами (поиск, качество, даты) и пагинацией.
- Модальное окно карточки лида с кнопками «Позвонить» и «Открыть в CRM».

## 5. Сборка для продакшена

```bash
cd frontend
npm run build
```

Готовая сборка появится в папке `build/`. Её можно задеплоить на любой статический хостинг (Netlify, Vercel, S3 и т.п.).

## 6. Структура фронтенда

```text
/frontend
  package.json
  tailwind.config.js
  postcss.config.js
  /public
    index.html
  /src
    index.js
    index.css
    App.jsx
    /api
      api.js
    /components
      Dashboard.jsx
      KPICards.jsx
      Charts.jsx
      LeadsTable.jsx
      LeadModal.jsx
```

### Ключевые компоненты

- `Dashboard.jsx` — основной контейнер дашборда:
  - хранит стейты фильтров, пагинации, загрузки, ошибки и выбранного лида,
  - делает запрос к API через `fetchLeads` (axios),
  - передает данные в KPI, графики и таблицу.

- `KPICards.jsx` — отображает:
  - всего лидов,
  - конверсию,
  - высокий потенциал,
  - качественные лиды,
  - последнего лида (имя + дата).

- `Charts.jsx` — три графика на базе Recharts:
  - PieChart — распределение по качеству (высокий/хороший/средний/низкий),
  - горизонтальный BarChart — лиды по моделям авто,
  - stacked BarChart — временной ряд за 30 дней, данные берутся из `aggregations.by_date` (там же лежат разбивки по качеству).

- `LeadsTable.jsx` — таблица с фильтрами и пагинацией:
  - поиск по имени/телефону,
  - фильтр по качеству,
  - фильтр по датам (from/to),
  - выбор размера страницы (10/25/50),
  - кнопка «Просмотр» для открытия модалки.

- `LeadModal.jsx` — модальное окно карточки клиента:
  - показывает все поля (имя, телефон, резюме, модель, качество, дата, источник, ссылка на CRM),
  - кнопка `tel:` для звонка,
  - кнопка открытия CRM-ссылки в новой вкладке.

## 7. Тестовые сценарии

После настройки:

1. В браузере откройте:

   ```text
   https://script.google.com/macros/s/XXXXXXXXXXXXXXX/exec?limit=10
   ```

   Убедитесь, что ответ соответствует JSON-контракту (`total`, `leads`, `aggregations`).

2. Запустите frontend (`npm start`) и откройте `http://localhost:3000`.

3. Проверьте:
   - таблица показывает 10 лидов (если `limit=10` по умолчанию),
   - фильтр по качеству (`высокий`, `хороший` и т.д.) корректно меняет количество строк,
   - поиск по имени/телефону,
   - смена размера страницы (10/25/50),
   - при клике на «Просмотр» открывается модалка.

4. В Google Sheets импортируйте ~50 строк данных и обновите страницу:
   - графики по моделям и качеству должны отражать распределение,
   - временная гистограмма должна покрывать последние 30 дней с разбивкой по качеству.

## 8. Безопасность

- **НЕ** коммитьте `.env` с реальным `REACT_APP_API_URL` и другими секретами в публичные репозитории.
- Если в Google Sheets хранятся реальные персональные данные, ограничьте доступ к Apps Script (например, только пользователи вашей доменной организации) и добавьте авторизацию.

