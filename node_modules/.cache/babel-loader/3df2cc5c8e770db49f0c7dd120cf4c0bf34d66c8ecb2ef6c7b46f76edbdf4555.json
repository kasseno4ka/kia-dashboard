{"ast":null,"code":"import axios from\"axios\";// В CRA переменные окружения должны начинаться с REACT_APP_\nconst API_URL=process.env.REACT_APP_API_URL;if(!API_URL){// Не падаем, но даем подсказку в консоли\n// eslint-disable-next-line no-console\nconsole.warn(\"REACT_APP_API_URL не задан. Установите его в .env, чтобы фронтенд мог обращаться к Apps Script.\");}const cache=new Map();function makeKey(params){return JSON.stringify(params);}/**\n * Запрос лидов и агрегаций с backend (Apps Script).\n * Оборачиваем параметры в объект params, чтобы axios сформировал query string.\n * Результаты кешируются в памяти до перезагрузки страницы.\n */export async function fetchLeads(){let{limit=10,offset=0,quality=\"all\",search=\"\",from,to,model=\"all\",source=\"all\"}=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!API_URL){throw new Error(\"REACT_APP_API_URL is not configured\");}const params={limit,offset,quality,search,model,source};if(from){params.from=from;}if(to){params.to=to;}const key=makeKey(params);if(cache.has(key)){return cache.get(key);}const response=await axios.get(API_URL,{params});cache.set(key,response.data);return response.data;}/**\n * Обновление статуса лида.\n */export async function updateLeadStatus(id,leadStatus){if(!API_URL){throw new Error(\"REACT_APP_API_URL is not configured\");}const response=await axios.post(API_URL,{action:\"update_status\",id,lead_status:leadStatus});// после изменения данных можно очистить кеш\ncache.clear();return response.data;}/**\n * Обновление тегов лида.\n */export async function updateLeadTags(id,tags){if(!API_URL){throw new Error(\"REACT_APP_API_URL is not configured\");}const response=await axios.post(API_URL,{action:\"update_tags\",id,tags});cache.clear();return response.data;}","map":{"version":3,"names":["axios","API_URL","process","env","REACT_APP_API_URL","console","warn","cache","Map","makeKey","params","JSON","stringify","fetchLeads","limit","offset","quality","search","from","to","model","source","arguments","length","undefined","Error","key","has","get","response","set","data","updateLeadStatus","id","leadStatus","post","action","lead_status","clear","updateLeadTags","tags"],"sources":["/Users/ikassen/kiakia/frontend/src/api/api.js"],"sourcesContent":["import axios from \"axios\";\n\n// В CRA переменные окружения должны начинаться с REACT_APP_\nconst API_URL = process.env.REACT_APP_API_URL;\n\nif (!API_URL) {\n  // Не падаем, но даем подсказку в консоли\n  // eslint-disable-next-line no-console\n  console.warn(\n    \"REACT_APP_API_URL не задан. Установите его в .env, чтобы фронтенд мог обращаться к Apps Script.\"\n  );\n}\n\nconst cache = new Map();\n\nfunction makeKey(params) {\n  return JSON.stringify(params);\n}\n\n/**\n * Запрос лидов и агрегаций с backend (Apps Script).\n * Оборачиваем параметры в объект params, чтобы axios сформировал query string.\n * Результаты кешируются в памяти до перезагрузки страницы.\n */\nexport async function fetchLeads({\n  limit = 10,\n  offset = 0,\n  quality = \"all\",\n  search = \"\",\n  from,\n  to,\n  model = \"all\",\n  source = \"all\"\n} = {}) {\n  if (!API_URL) {\n    throw new Error(\"REACT_APP_API_URL is not configured\");\n  }\n\n  const params = {\n    limit,\n    offset,\n    quality,\n    search,\n    model,\n    source\n  };\n\n  if (from) {\n    params.from = from;\n  }\n  if (to) {\n    params.to = to;\n  }\n\n  const key = makeKey(params);\n  if (cache.has(key)) {\n    return cache.get(key);\n  }\n\n  const response = await axios.get(API_URL, { params });\n  cache.set(key, response.data);\n  return response.data;\n}\n\n/**\n * Обновление статуса лида.\n */\nexport async function updateLeadStatus(id, leadStatus) {\n  if (!API_URL) {\n    throw new Error(\"REACT_APP_API_URL is not configured\");\n  }\n\n  const response = await axios.post(API_URL, {\n    action: \"update_status\",\n    id,\n    lead_status: leadStatus\n  });\n\n  // после изменения данных можно очистить кеш\n  cache.clear();\n  return response.data;\n}\n\n/**\n * Обновление тегов лида.\n */\nexport async function updateLeadTags(id, tags) {\n  if (!API_URL) {\n    throw new Error(\"REACT_APP_API_URL is not configured\");\n  }\n\n  const response = await axios.post(API_URL, {\n    action: \"update_tags\",\n    id,\n    tags\n  });\n\n  cache.clear();\n  return response.data;\n}\n\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CAEzB;AACA,KAAM,CAAAC,OAAO,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,CAE7C,GAAI,CAACH,OAAO,CAAE,CACZ;AACA;AACAI,OAAO,CAACC,IAAI,CACV,iGACF,CAAC,CACH,CAEA,KAAM,CAAAC,KAAK,CAAG,GAAI,CAAAC,GAAG,CAAC,CAAC,CAEvB,QAAS,CAAAC,OAAOA,CAACC,MAAM,CAAE,CACvB,MAAO,CAAAC,IAAI,CAACC,SAAS,CAACF,MAAM,CAAC,CAC/B,CAEA;AACA;AACA;AACA;AACA,GACA,MAAO,eAAe,CAAAG,UAAUA,CAAA,CASxB,IATyB,CAC/BC,KAAK,CAAG,EAAE,CACVC,MAAM,CAAG,CAAC,CACVC,OAAO,CAAG,KAAK,CACfC,MAAM,CAAG,EAAE,CACXC,IAAI,CACJC,EAAE,CACFC,KAAK,CAAG,KAAK,CACbC,MAAM,CAAG,KACX,CAAC,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,CAAC,CAAC,CACJ,GAAI,CAACrB,OAAO,CAAE,CACZ,KAAM,IAAI,CAAAwB,KAAK,CAAC,qCAAqC,CAAC,CACxD,CAEA,KAAM,CAAAf,MAAM,CAAG,CACbI,KAAK,CACLC,MAAM,CACNC,OAAO,CACPC,MAAM,CACNG,KAAK,CACLC,MACF,CAAC,CAED,GAAIH,IAAI,CAAE,CACRR,MAAM,CAACQ,IAAI,CAAGA,IAAI,CACpB,CACA,GAAIC,EAAE,CAAE,CACNT,MAAM,CAACS,EAAE,CAAGA,EAAE,CAChB,CAEA,KAAM,CAAAO,GAAG,CAAGjB,OAAO,CAACC,MAAM,CAAC,CAC3B,GAAIH,KAAK,CAACoB,GAAG,CAACD,GAAG,CAAC,CAAE,CAClB,MAAO,CAAAnB,KAAK,CAACqB,GAAG,CAACF,GAAG,CAAC,CACvB,CAEA,KAAM,CAAAG,QAAQ,CAAG,KAAM,CAAA7B,KAAK,CAAC4B,GAAG,CAAC3B,OAAO,CAAE,CAAES,MAAO,CAAC,CAAC,CACrDH,KAAK,CAACuB,GAAG,CAACJ,GAAG,CAAEG,QAAQ,CAACE,IAAI,CAAC,CAC7B,MAAO,CAAAF,QAAQ,CAACE,IAAI,CACtB,CAEA;AACA;AACA,GACA,MAAO,eAAe,CAAAC,gBAAgBA,CAACC,EAAE,CAAEC,UAAU,CAAE,CACrD,GAAI,CAACjC,OAAO,CAAE,CACZ,KAAM,IAAI,CAAAwB,KAAK,CAAC,qCAAqC,CAAC,CACxD,CAEA,KAAM,CAAAI,QAAQ,CAAG,KAAM,CAAA7B,KAAK,CAACmC,IAAI,CAAClC,OAAO,CAAE,CACzCmC,MAAM,CAAE,eAAe,CACvBH,EAAE,CACFI,WAAW,CAAEH,UACf,CAAC,CAAC,CAEF;AACA3B,KAAK,CAAC+B,KAAK,CAAC,CAAC,CACb,MAAO,CAAAT,QAAQ,CAACE,IAAI,CACtB,CAEA;AACA;AACA,GACA,MAAO,eAAe,CAAAQ,cAAcA,CAACN,EAAE,CAAEO,IAAI,CAAE,CAC7C,GAAI,CAACvC,OAAO,CAAE,CACZ,KAAM,IAAI,CAAAwB,KAAK,CAAC,qCAAqC,CAAC,CACxD,CAEA,KAAM,CAAAI,QAAQ,CAAG,KAAM,CAAA7B,KAAK,CAACmC,IAAI,CAAClC,OAAO,CAAE,CACzCmC,MAAM,CAAE,aAAa,CACrBH,EAAE,CACFO,IACF,CAAC,CAAC,CAEFjC,KAAK,CAAC+B,KAAK,CAAC,CAAC,CACb,MAAO,CAAAT,QAAQ,CAACE,IAAI,CACtB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}