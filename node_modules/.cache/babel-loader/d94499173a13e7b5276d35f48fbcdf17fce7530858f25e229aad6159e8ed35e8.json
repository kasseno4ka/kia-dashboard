{"ast":null,"code":"import axios from \"axios\";\n\n// В CRA переменные окружения должны начинаться с REACT_APP_\nconst API_URL = process.env.REACT_APP_API_URL;\nif (!API_URL) {\n  // Не падаем, но даем подсказку в консоли\n  // eslint-disable-next-line no-console\n  console.warn(\"REACT_APP_API_URL не задан. Установите его в .env, чтобы фронтенд мог обращаться к Apps Script.\");\n}\nconst cache = new Map();\nfunction makeKey(params) {\n  return JSON.stringify(params);\n}\n\n/**\n * Запрос лидов и агрегаций с backend (Apps Script).\n * Оборачиваем параметры в объект params, чтобы axios сформировал query string.\n * Результаты кешируются в памяти до перезагрузки страницы.\n */\nexport async function fetchLeads({\n  limit = 10,\n  offset = 0,\n  quality = \"all\",\n  search = \"\",\n  from,\n  to,\n  model = \"all\",\n  source = \"all\"\n} = {}) {\n  if (!API_URL) {\n    throw new Error(\"REACT_APP_API_URL is not configured\");\n  }\n  const params = {\n    limit,\n    offset,\n    quality,\n    search,\n    model,\n    source\n  };\n  if (from) {\n    params.from = from;\n  }\n  if (to) {\n    params.to = to;\n  }\n  const key = makeKey(params);\n  if (cache.has(key)) {\n    return cache.get(key);\n  }\n  const response = await axios.get(API_URL, {\n    params\n  });\n  cache.set(key, response.data);\n  return response.data;\n}\n\n/**\n * Обновление статуса лида.\n */\nexport async function updateLeadStatus(id, leadStatus) {\n  if (!API_URL) {\n    throw new Error(\"REACT_APP_API_URL is not configured\");\n  }\n  const response = await axios.post(API_URL, {\n    action: \"update_status\",\n    id,\n    lead_status: leadStatus\n  });\n\n  // после изменения данных можно очистить кеш\n  cache.clear();\n  return response.data;\n}\n\n/**\n * Обновление тегов лида.\n */\nexport async function updateLeadTags(id, tags) {\n  if (!API_URL) {\n    throw new Error(\"REACT_APP_API_URL is not configured\");\n  }\n  const response = await axios.post(API_URL, {\n    action: \"update_tags\",\n    id,\n    tags\n  });\n  cache.clear();\n  return response.data;\n}","map":{"version":3,"names":["axios","API_URL","process","env","REACT_APP_API_URL","console","warn","cache","Map","makeKey","params","JSON","stringify","fetchLeads","limit","offset","quality","search","from","to","model","source","Error","key","has","get","response","set","data","updateLeadStatus","id","leadStatus","post","action","lead_status","clear","updateLeadTags","tags"],"sources":["/Users/ikassen/kiakia/frontend/src/api/api.js"],"sourcesContent":["import axios from \"axios\";\n\n// В CRA переменные окружения должны начинаться с REACT_APP_\nconst API_URL = process.env.REACT_APP_API_URL;\n\nif (!API_URL) {\n  // Не падаем, но даем подсказку в консоли\n  // eslint-disable-next-line no-console\n  console.warn(\n    \"REACT_APP_API_URL не задан. Установите его в .env, чтобы фронтенд мог обращаться к Apps Script.\"\n  );\n}\n\nconst cache = new Map();\n\nfunction makeKey(params) {\n  return JSON.stringify(params);\n}\n\n/**\n * Запрос лидов и агрегаций с backend (Apps Script).\n * Оборачиваем параметры в объект params, чтобы axios сформировал query string.\n * Результаты кешируются в памяти до перезагрузки страницы.\n */\nexport async function fetchLeads({\n  limit = 10,\n  offset = 0,\n  quality = \"all\",\n  search = \"\",\n  from,\n  to,\n  model = \"all\",\n  source = \"all\"\n} = {}) {\n  if (!API_URL) {\n    throw new Error(\"REACT_APP_API_URL is not configured\");\n  }\n\n  const params = {\n    limit,\n    offset,\n    quality,\n    search,\n    model,\n    source\n  };\n\n  if (from) {\n    params.from = from;\n  }\n  if (to) {\n    params.to = to;\n  }\n\n  const key = makeKey(params);\n  if (cache.has(key)) {\n    return cache.get(key);\n  }\n\n  const response = await axios.get(API_URL, { params });\n  cache.set(key, response.data);\n  return response.data;\n}\n\n/**\n * Обновление статуса лида.\n */\nexport async function updateLeadStatus(id, leadStatus) {\n  if (!API_URL) {\n    throw new Error(\"REACT_APP_API_URL is not configured\");\n  }\n\n  const response = await axios.post(API_URL, {\n    action: \"update_status\",\n    id,\n    lead_status: leadStatus\n  });\n\n  // после изменения данных можно очистить кеш\n  cache.clear();\n  return response.data;\n}\n\n/**\n * Обновление тегов лида.\n */\nexport async function updateLeadTags(id, tags) {\n  if (!API_URL) {\n    throw new Error(\"REACT_APP_API_URL is not configured\");\n  }\n\n  const response = await axios.post(API_URL, {\n    action: \"update_tags\",\n    id,\n    tags\n  });\n\n  cache.clear();\n  return response.data;\n}\n\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;;AAEzB;AACA,MAAMC,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB;AAE7C,IAAI,CAACH,OAAO,EAAE;EACZ;EACA;EACAI,OAAO,CAACC,IAAI,CACV,iGACF,CAAC;AACH;AAEA,MAAMC,KAAK,GAAG,IAAIC,GAAG,CAAC,CAAC;AAEvB,SAASC,OAAOA,CAACC,MAAM,EAAE;EACvB,OAAOC,IAAI,CAACC,SAAS,CAACF,MAAM,CAAC;AAC/B;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,eAAeG,UAAUA,CAAC;EAC/BC,KAAK,GAAG,EAAE;EACVC,MAAM,GAAG,CAAC;EACVC,OAAO,GAAG,KAAK;EACfC,MAAM,GAAG,EAAE;EACXC,IAAI;EACJC,EAAE;EACFC,KAAK,GAAG,KAAK;EACbC,MAAM,GAAG;AACX,CAAC,GAAG,CAAC,CAAC,EAAE;EACN,IAAI,CAACpB,OAAO,EAAE;IACZ,MAAM,IAAIqB,KAAK,CAAC,qCAAqC,CAAC;EACxD;EAEA,MAAMZ,MAAM,GAAG;IACbI,KAAK;IACLC,MAAM;IACNC,OAAO;IACPC,MAAM;IACNG,KAAK;IACLC;EACF,CAAC;EAED,IAAIH,IAAI,EAAE;IACRR,MAAM,CAACQ,IAAI,GAAGA,IAAI;EACpB;EACA,IAAIC,EAAE,EAAE;IACNT,MAAM,CAACS,EAAE,GAAGA,EAAE;EAChB;EAEA,MAAMI,GAAG,GAAGd,OAAO,CAACC,MAAM,CAAC;EAC3B,IAAIH,KAAK,CAACiB,GAAG,CAACD,GAAG,CAAC,EAAE;IAClB,OAAOhB,KAAK,CAACkB,GAAG,CAACF,GAAG,CAAC;EACvB;EAEA,MAAMG,QAAQ,GAAG,MAAM1B,KAAK,CAACyB,GAAG,CAACxB,OAAO,EAAE;IAAES;EAAO,CAAC,CAAC;EACrDH,KAAK,CAACoB,GAAG,CAACJ,GAAG,EAAEG,QAAQ,CAACE,IAAI,CAAC;EAC7B,OAAOF,QAAQ,CAACE,IAAI;AACtB;;AAEA;AACA;AACA;AACA,OAAO,eAAeC,gBAAgBA,CAACC,EAAE,EAAEC,UAAU,EAAE;EACrD,IAAI,CAAC9B,OAAO,EAAE;IACZ,MAAM,IAAIqB,KAAK,CAAC,qCAAqC,CAAC;EACxD;EAEA,MAAMI,QAAQ,GAAG,MAAM1B,KAAK,CAACgC,IAAI,CAAC/B,OAAO,EAAE;IACzCgC,MAAM,EAAE,eAAe;IACvBH,EAAE;IACFI,WAAW,EAAEH;EACf,CAAC,CAAC;;EAEF;EACAxB,KAAK,CAAC4B,KAAK,CAAC,CAAC;EACb,OAAOT,QAAQ,CAACE,IAAI;AACtB;;AAEA;AACA;AACA;AACA,OAAO,eAAeQ,cAAcA,CAACN,EAAE,EAAEO,IAAI,EAAE;EAC7C,IAAI,CAACpC,OAAO,EAAE;IACZ,MAAM,IAAIqB,KAAK,CAAC,qCAAqC,CAAC;EACxD;EAEA,MAAMI,QAAQ,GAAG,MAAM1B,KAAK,CAACgC,IAAI,CAAC/B,OAAO,EAAE;IACzCgC,MAAM,EAAE,aAAa;IACrBH,EAAE;IACFO;EACF,CAAC,CAAC;EAEF9B,KAAK,CAAC4B,KAAK,CAAC,CAAC;EACb,OAAOT,QAAQ,CAACE,IAAI;AACtB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}