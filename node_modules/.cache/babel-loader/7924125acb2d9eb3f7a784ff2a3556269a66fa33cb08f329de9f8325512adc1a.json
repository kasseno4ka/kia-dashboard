{"ast":null,"code":"import React,{useMemo}from\"react\";import{format}from\"date-fns\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function formatDateTime(value){if(!value)return\"—\";try{const date=new Date(value);if(isNaN(date.getTime()))return value;return format(date,\"dd.MM.yyyy HH:mm\");}catch(_unused){return value;}}const KPICards=_ref=>{let{kpi,loading}=_ref;if(!kpi&&!loading)return null;const{total_leads,conversion,high_potential_pct,quality_leads,last_lead_name,last_lead_datetime,total_leads_prev,conversion_prev,high_potential_pct_prev,quality_leads_prev}=kpi||{};const calcDelta=(current,previous)=>{if(current==null||previous==null)return null;const curr=typeof current===\"string\"&&current.endsWith(\"%\")?parseFloat(current):Number(current);const prev=typeof previous===\"string\"&&previous.endsWith(\"%\")?parseFloat(previous):Number(previous);if(!isFinite(curr)||!isFinite(prev)||prev===0)return null;const delta=(curr-prev)/prev*100;return Math.round(delta);};const cards=useMemo(()=>[{label:\"Всего лидов\",value:total_leads!==null&&total_leads!==void 0?total_leads:0,delta:calcDelta(total_leads,total_leads_prev),hint:\"Количество записей с учетом фильтров\"},{label:\"Конверсия\",value:conversion!==null&&conversion!==void 0?conversion:\"—\",delta:calcDelta(conversion,conversion_prev),hint:\"Доля лидов с качеством выше низкого\"},{label:\"Высокий потенциал\",value:high_potential_pct!==null&&high_potential_pct!==void 0?high_potential_pct:\"—\",delta:calcDelta(high_potential_pct,high_potential_pct_prev),hint:\"Процент лидов с качеством «высокий»\"},{label:\"Качественные лиды\",value:quality_leads!==null&&quality_leads!==void 0?quality_leads:0,delta:calcDelta(quality_leads,quality_leads_prev),hint:\"Всего лидов с качеством высокий/хороший\"},{label:\"Последний лид\",value:last_lead_name||\"—\",extra:last_lead_datetime?formatDateTime(last_lead_datetime):\"\",hint:\"Имя и время последнего лида\"}],[total_leads,total_leads_prev,conversion,conversion_prev,high_potential_pct,high_potential_pct_prev,quality_leads,quality_leads_prev,last_lead_name,last_lead_datetime]);return/*#__PURE__*/_jsx(\"div\",{className:\"grid gap-4 sm:grid-cols-2 lg:grid-cols-5 mb-6\",children:cards.map(card=>{const delta=card.delta;const hasDelta=delta!==null&&delta!==undefined;const isPositive=hasDelta&&delta>0;const isNegative=hasDelta&&delta<0;const deltaColor=isPositive?\"text-emerald-600 dark:text-emerald-400\":isNegative?\"text-rose-600 dark:text-rose-400\":\"text-slate-400 dark:text-slate-500\";return/*#__PURE__*/_jsxs(\"div\",{className:\"card p-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header flex items-center justify-between\",children:/*#__PURE__*/_jsx(\"span\",{children:card.label})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex items-baseline justify-between\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-value\",children:loading&&card.label!==\"Последний лид\"?\"—\":card.value}),card.extra&&/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-xs text-slate-500 dark:text-slate-400\",children:card.extra})]}),card.hint&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-xs text-slate-500 dark:text-slate-400\",children:card.hint}),hasDelta&&card.label!==\"Последний лид\"&&/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1 text-xs font-medium \".concat(deltaColor),title:\"\\u0414\\u0438\\u043D\\u0430\\u043C\\u0438\\u043A\\u0430 \\u043A \\u043F\\u0440\\u0435\\u0434\\u044B\\u0434\\u0443\\u0449\\u0435\\u043C\\u0443 \\u0430\\u043D\\u0430\\u043B\\u043E\\u0433\\u0438\\u0447\\u043D\\u043E\\u043C\\u0443 \\u043F\\u0435\\u0440\\u0438\\u043E\\u0434\\u0443\",children:[delta>0&&\"↑ \",delta<0&&\"↓ \",delta===0?\"0%\":\"\".concat(Math.abs(delta),\"%\"),\" \\u043A \\u043F\\u0440\\u043E\\u0448\\u043B\\u043E\\u043C\\u0443 \\u043F\\u0435\\u0440\\u0438\\u043E\\u0434\\u0443\"]})]},card.label);})});};export default KPICards;","map":{"version":3,"names":["React","useMemo","format","jsx","_jsx","jsxs","_jsxs","formatDateTime","value","date","Date","isNaN","getTime","_unused","KPICards","_ref","kpi","loading","total_leads","conversion","high_potential_pct","quality_leads","last_lead_name","last_lead_datetime","total_leads_prev","conversion_prev","high_potential_pct_prev","quality_leads_prev","calcDelta","current","previous","curr","endsWith","parseFloat","Number","prev","isFinite","delta","Math","round","cards","label","hint","extra","className","children","map","card","hasDelta","undefined","isPositive","isNegative","deltaColor","concat","title","abs"],"sources":["/Users/ikassen/kiakia/frontend/src/components/KPICards.jsx"],"sourcesContent":["import React, { useMemo } from \"react\";\nimport { format } from \"date-fns\";\n\nfunction formatDateTime(value) {\n  if (!value) return \"—\";\n  try {\n    const date = new Date(value);\n    if (isNaN(date.getTime())) return value;\n    return format(date, \"dd.MM.yyyy HH:mm\");\n  } catch {\n    return value;\n  }\n}\n\nconst KPICards = ({ kpi, loading }) => {\n  if (!kpi && !loading) return null;\n\n  const {\n    total_leads,\n    conversion,\n    high_potential_pct,\n    quality_leads,\n    last_lead_name,\n    last_lead_datetime,\n    total_leads_prev,\n    conversion_prev,\n    high_potential_pct_prev,\n    quality_leads_prev,\n  } = kpi || {};\n\n  const calcDelta = (current, previous) => {\n    if (current == null || previous == null) return null;\n    const curr = typeof current === \"string\" && current.endsWith(\"%\")\n      ? parseFloat(current)\n      : Number(current);\n    const prev = typeof previous === \"string\" && previous.endsWith(\"%\")\n      ? parseFloat(previous)\n      : Number(previous);\n    if (!isFinite(curr) || !isFinite(prev) || prev === 0) return null;\n    const delta = ((curr - prev) / prev) * 100;\n    return Math.round(delta);\n  };\n\n  const cards = useMemo(\n    () => [\n      {\n        label: \"Всего лидов\",\n        value: total_leads ?? 0,\n        delta: calcDelta(total_leads, total_leads_prev),\n        hint: \"Количество записей с учетом фильтров\"\n      },\n      {\n        label: \"Конверсия\",\n        value: conversion ?? \"—\",\n        delta: calcDelta(conversion, conversion_prev),\n        hint: \"Доля лидов с качеством выше низкого\"\n      },\n      {\n        label: \"Высокий потенциал\",\n        value: high_potential_pct ?? \"—\",\n        delta: calcDelta(high_potential_pct, high_potential_pct_prev),\n        hint: \"Процент лидов с качеством «высокий»\"\n      },\n      {\n        label: \"Качественные лиды\",\n        value: quality_leads ?? 0,\n        delta: calcDelta(quality_leads, quality_leads_prev),\n        hint: \"Всего лидов с качеством высокий/хороший\"\n      },\n      {\n        label: \"Последний лид\",\n        value: last_lead_name || \"—\",\n        extra: last_lead_datetime ? formatDateTime(last_lead_datetime) : \"\",\n        hint: \"Имя и время последнего лида\"\n      }\n    ],\n    [\n      total_leads,\n      total_leads_prev,\n      conversion,\n      conversion_prev,\n      high_potential_pct,\n      high_potential_pct_prev,\n      quality_leads,\n      quality_leads_prev,\n      last_lead_name,\n      last_lead_datetime\n    ]\n  );\n\n  return (\n    <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-5 mb-6\">\n      {cards.map((card) => {\n        const delta = card.delta;\n        const hasDelta = delta !== null && delta !== undefined;\n        const isPositive = hasDelta && delta > 0;\n        const isNegative = hasDelta && delta < 0;\n        const deltaColor = isPositive\n          ? \"text-emerald-600 dark:text-emerald-400\"\n          : isNegative\n          ? \"text-rose-600 dark:text-rose-400\"\n          : \"text-slate-400 dark:text-slate-500\";\n\n        return (\n          <div key={card.label} className=\"card p-4\">\n            <div className=\"card-header flex items-center justify-between\">\n              <span>{card.label}</span>\n            </div>\n            <div className=\"mt-2 flex items-baseline justify-between\">\n              <div className=\"card-value\">\n                {loading && card.label !== \"Последний лид\" ? \"—\" : card.value}\n              </div>\n              {card.extra && (\n                <span className=\"ml-2 text-xs text-slate-500 dark:text-slate-400\">\n                  {card.extra}\n                </span>\n              )}\n            </div>\n            {card.hint && (\n              <p className=\"mt-1 text-xs text-slate-500 dark:text-slate-400\">\n                {card.hint}\n              </p>\n            )}\n            {hasDelta && card.label !== \"Последний лид\" && (\n              <p\n                className={`mt-1 text-xs font-medium ${deltaColor}`}\n                title=\"Динамика к предыдущему аналогичному периоду\"\n              >\n                {delta > 0 && \"↑ \"}\n                {delta < 0 && \"↓ \"}\n                {delta === 0 ? \"0%\" : `${Math.abs(delta)}%`} к прошлому периоду\n              </p>\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nexport default KPICards;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}